#!/usr/bin/perl

use strict;
use warnings;

use Data::Dumper;
use Carp qw(cluck confess);

use Email::Sender::Simple qw(sendmail);

use CML::ActivityMgr;

my $usage = "Usage: $0 OWNER CARD_NUMBER PIN EMAIL_TO EMAIL_FROM";
my ($owner, $card_number, $pin, $email_to, $email_from) = @ARGV;
die "$usage\n" unless $owner && $card_number && $pin && $email_to && $email_from;

my $cfg = {
    owner           => $owner,
    email_to        => $email_to,
    email_from      => $email_from,
    card_number     => $card_number,
    pin             => $pin,
};

my $activity_mgr = CML::ActivityMgr->new(owner => $cfg->{owner}, card_number => $cfg->{card_number}, pin => $cfg->{pin});;
$activity_mgr->renew;
$activity_mgr->flag_nonrenewable;
my $email = $activity_mgr->activity_email;
$email->header_str_set(To => $cfg->{email_to});
sendmail($email);

exit;
