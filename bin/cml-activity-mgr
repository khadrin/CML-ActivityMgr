#!/usr/bin/perl

use strict;
use warnings;

use Data::Dumper;
use Carp qw(cluck confess);

use Email::Sender::Simple qw(sendmail);

use CML::ActivityMgr;

my $usage = "Usage: $0 OWNER EMAIL_TO CARD_NUMBER PIN";
my ($owner, $email_to, $card_number, $pin) = @ARGV;
die "$usage\n" unless $owner && $email_to && $card_number && $pin;

my $cfg = {
    owner           => $owner,
    email_to        => $email_to ,
    card_number     => $card_number,
    pin             => $pin,
    flag_days_left  => 7,
    renew_days_left => 1,
    renew_noop     => 0,
};

my $activity_mgr = CML::ActivityMgr->new(owner => $cfg->{owner}, card_number => $cfg->{card_number}, pin => $cfg->{pin});;
$activity_mgr->renew(days_left => $cfg->{renew_days_left});
$activity_mgr->flag_nonrenewable(days_left => $cfg->{flag_days_left});
my $email = $activity_mgr->activity_email;
print $email->as_string;
sendmail($email, { to => $cfg->{email_to} }) if $email;

exit;
